/* --- General UI Components --- */

html, body {
    overscroll-behavior: contain;
}

/* Scrollable containers should contain their own scroll */
.overflow-y-auto, 
.overflow-auto,
#theme-browser-list,
.manual-page,
#detail-modal > div {
    overscroll-behavior: contain;
}

/* Custom Checkbox */
.custom-checkbox {
    appearance: none;
    background-color: var(--bg-primary);
    width: 1.5em; height: 1.5em;
    border: 2px solid var(--border);
    border-radius: 0.25em;
    display: grid; place-content: center;
    cursor: pointer;
}
.custom-checkbox::before {
    content: ""; width: 0.65em; height: 0.65em;
    transform: scale(0); transition: 120ms transform ease-in-out;
    box-shadow: inset 1em 1em white;
    clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
}
.custom-checkbox:checked { background-color: #10b981; border-color: #10b981; }
.custom-checkbox:checked::before { transform: scale(1); }

[data-theme='legacy'] .custom-checkbox:checked { background-color: #ffffff !important; border-color: #ffffff !important; }
[data-theme='legacy'] .custom-checkbox:checked::before { box-shadow: inset 1em 1em #000000 !important; }

[data-theme='brick'] .custom-checkbox:checked { background-color: var(--accent) !important; border-color: var(--accent) !important; }
[data-theme='brick'] .custom-checkbox:checked::before { box-shadow: inset 1em 1em var(--bg-primary) !important; }

[data-theme='os'] .custom-checkbox:checked { background-color: #000080 !important; border-color: #000080 !important; }

[data-theme='blueprint'] .custom-checkbox { border-radius: 0; border-color: #fff; }
[data-theme='blueprint'] .custom-checkbox:checked { background-color: var(--accent) !important; border-color: var(--accent) !important; }
[data-theme='blueprint'] .custom-checkbox:checked::before { box-shadow: inset 1em 1em #002b5c !important; }

[data-theme='woodgrain'] .custom-checkbox { border-radius: 2px; border-color: #1a0f00; background: #5c4033; }
[data-theme='woodgrain'] .custom-checkbox:checked { background-color: #ffbf00 !important; border-color: #1a0f00 !important; }
[data-theme='woodgrain'] .custom-checkbox:checked::before { box-shadow: inset 1em 1em #1a0f00 !important; }

[data-theme='papercraft'] .custom-checkbox { border-radius: 0; border: 2px solid #333; background: #fff; }
[data-theme='papercraft'] .custom-checkbox:checked { background-color: #333 !important; border-color: #333 !important; }
[data-theme='papercraft'] .custom-checkbox:checked::before { box-shadow: inset 1em 1em #fff !important; }

[data-theme='candy'] .custom-checkbox { border-radius: 50%; border-color: #ffffff; background: rgba(255,255,255,0.2); }
[data-theme='candy'] .custom-checkbox:checked { background-color: #ff00ff !important; border-color: #ffffff !important; }
[data-theme='candy'] .custom-checkbox:checked::before { box-shadow: inset 1em 1em #ffffff !important; }

[data-theme='arcade'] .custom-checkbox { border-radius: 0; border-color: #00f2ff; background: #000; }
[data-theme='arcade'] .custom-checkbox:checked { background-color: #ff00ff !important; border-color: #ff00ff !important; box-shadow: 0 0 10px #ff00ff; }
[data-theme='arcade'] .custom-checkbox:checked::before { box-shadow: inset 1em 1em #fff !important; }
[data-theme='arcade'] #progress-bar { background-color: #ff00ff !important; box-shadow: 0 0 15px #ff00ff !important; }
[data-theme='arcade'] #xp-bar { background-color: #00f2ff !important; box-shadow: 0 0 10px #00f2ff !important; }

[data-theme='obsidian'] .custom-checkbox { border-radius: 0; border-color: #333; background: #000; }
[data-theme='obsidian'] .custom-checkbox:checked { background-color: #ff6600 !important; border-color: #ff6600 !important; }
[data-theme='obsidian'] .custom-checkbox:checked::before { box-shadow: inset 1em 1em #000 !important; }
[data-theme='obsidian'] #progress-bar { background-color: #ff6600 !important; }
[data-theme='obsidian'] #xp-bar { background-color: #333 !important; }

.membership-card-container {
    perspective: 1000px;
}

.membership-card {
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Blueprint Card */
.membership-card[data-card-theme='blueprint'] {
    background-color: #002b5c !important;
    border: 2px double #ffffff !important;
    background-image: 
        linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px) !important;
    background-size: 15px 15px !important;
}

/* Arcade Card */
.membership-card[data-card-theme='arcade'] {
    background-color: #000000 !important;
    border: 2px solid #ff00ff !important;
    box-shadow: 0 0 20px #ff00ff, inset 0 0 10px #ff00ff !important;
}
.membership-card[data-card-theme='arcade'] #membership-card-inner {
    color: #ff00ff !important;
}

/* Woodgrain Card */
.membership-card[data-card-theme='woodgrain'] {
    background-color: #fdf5e6 !important;
    border: 4px solid #1a0f00 !important;
}
.membership-card[data-card-theme='woodgrain'] #membership-card-inner h5,
.membership-card[data-card-theme='woodgrain'] #membership-card-inner span,
.membership-card[data-card-theme='woodgrain'] #membership-card-inner div {
    color: #1a0f00 !important;
}

/* Papercraft Card */
.membership-card[data-card-theme='papercraft'] {
    background-color: #f4eee1 !important;
    background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png') !important;
    border: 2px solid #333 !important;
    border-radius: 2px !important;
}
.membership-card[data-card-theme='papercraft'] #membership-card-inner h5,
.membership-card[data-card-theme='papercraft'] #membership-card-inner span,
.membership-card[data-card-theme='papercraft'] #membership-card-inner div {
    color: #333 !important;
}

/* Candy Card */
.membership-card[data-card-theme='candy'] {
    background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7)) !important;
    backdrop-filter: blur(10px) !important;
    border: 2px solid #ffffff !important;
    border-radius: 2rem !important;
    box-shadow: 0 10px 30px rgba(0, 210, 255, 0.3) !important;
}
.membership-card[data-card-theme='candy'] #membership-card-inner h5,
.membership-card[data-card-theme='candy'] #membership-card-inner span,
.membership-card[data-card-theme='candy'] #membership-card-inner div {
    color: #1a1a1a !important;
}

/* OS Card */
.membership-card[data-card-theme='os'] {
    background-color: #c0c0c0 !important;
    border: 2px solid !important;
    border-color: #ffffff #808080 #808080 #ffffff !important;
    border-radius: 0 !important;
}
.membership-card[data-card-theme='os'] #membership-card-inner h5,
.membership-card[data-card-theme='os'] #membership-card-inner span,
.membership-card[data-card-theme='os'] #membership-card-inner div {
    color: #000000 !important;
}

/* Brick Card */
.membership-card[data-card-theme='brick'] {
    background-color: #8bac0f !important;
    border: 4px solid #0f380f !important;
    image-rendering: pixelated;
}
.membership-card[data-card-theme='brick'] #membership-card-inner h5,
.membership-card[data-card-theme='brick'] #membership-card-inner span,
.membership-card[data-card-theme='brick'] #membership-card-inner div {
    color: #0f380f !important;
}

/* Legacy Card */
.membership-card[data-card-theme='legacy'] {
    background-color: #000000 !important;
    border: 1px solid #ffffff !important;
    border-radius: 0.5rem !important;
}

/* Hover Shimmer Refinement */
.membership-card:hover #card-shimmer {
    background: linear-gradient(to right, transparent, rgba(255,255,255,0.1), transparent) !important;
    transform: translateX(100%);
}
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--bg-header); border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: var(--accent); }

/* Progress & XP Bars */
#progress-bar, #xp-bar { transition: all 0.7s ease-out; }
[data-theme='legacy'] #progress-bar, [data-theme='legacy'] #xp-bar { background-color: #ffffff !important; background-image: none !important; }
[data-theme='legacy'] .bg-gaming-dark, [data-theme='legacy'] .bg-gray-700 { background-color: #000000 !important; }
[data-theme='legacy'] .bg-gray-700 { border: 1px solid #ffffff !important; }
[data-theme='legacy'] .bg-gray-700:hover { background-color: #000000 !important; }
[data-theme='legacy'] .bg-gradient-to-r { background-image: none !important; }

/* OS Progress Overrides */
[data-theme='os'] #progress-bar, [data-theme='os'] #xp-bar { 
    background-color: #000080 !important; 
    background-image: none !important; 
    border-radius: 0 !important;
}
[data-theme='os'] .bg-gray-700, [data-theme='os'] .bg-gray-800 { 
    background-color: #ffffff !important; 
    border: 1px solid #808080 !important; 
    border-radius: 0 !important; 
}
[data-theme='os'] .bg-gray-700:hover { background-color: #ffffff !important; }

/* Brick Progress Overrides */
[data-theme='brick'] #progress-bar, [data-theme='brick'] #xp-bar { background-color: var(--accent) !important; background-image: none !important; }
[data-theme='brick'] .bg-gray-700, [data-theme='brick'] .bg-gray-800 { background-color: var(--bg-primary) !important; border: 1px solid var(--accent); }

/* --- List Headers --- */
[data-theme='brick'] .list-accent-bar { background-color: var(--accent) !important; width: 4px; border-radius: 0; }
[data-theme='brick'] .list-count-badge { background-color: var(--accent) !important; color: var(--bg-primary) !important; border-radius: 0; }

[data-theme='cube'] .list-accent-bar { background: linear-gradient(to bottom, #ff4500, #4b0082) !important; width: 6px; }
[data-theme='cube'] .list-count-badge { background-color: #4b0082 !important; color: #ffffff !important; border: 2px solid #ffffff !important; border-radius: 1rem; }

[data-theme='os'] .list-accent-bar { background-color: #808080 !important; width: 2px; border-radius: 0; }
[data-theme='os'] .list-count-badge { background-color: #c0c0c0 !important; color: #000000 !important; border: 1px solid #808080 !important; border-radius: 0; }

[data-theme='legacy'] .list-accent-bar { background-color: #ffffff !important; width: 1px; border-radius: 0; }
[data-theme='legacy'] .list-count-badge { background-color: #000000 !important; color: #ffffff !important; border: 1px solid #ffffff !important; border-radius: 0; }

/* --- Trophies --- */
.trophy { transition: all 0.5s ease; filter: grayscale(1) opacity(0.3); }
.trophy.unlocked { filter: grayscale(0) opacity(1); }

/* Hide lock on unlock */
.trophy-slot.unlocked .trophy-lock {
    opacity: 0;
    pointer-events: none;
}

[data-theme='legacy'] .bg-yellow-500 { background-color: #ffffff !important; }
[data-theme='brick'] .bg-yellow-500 { background-color: var(--accent) !important; }
[data-theme='os'] .bg-yellow-500 { background-color: #808080 !important; }

/* Default Unlocked Pulse */
.trophy-slot.unlocked .trophy-icon-container {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 10px 20px rgba(0,0,0,0.3);
}

/* Future: Neon Cyan Glow */
[data-theme='future'] .trophy-slot.unlocked .trophy-icon-container {
    border-color: #22d3ee !important;
    box-shadow: 0 0 25px rgba(34, 211, 238, 0.4);
    background: rgba(8, 145, 178, 0.2) !important;
}

/* Brick: Pixel "Jump" and Thick Border */
[data-theme='brick'] .trophy-slot.unlocked .trophy-icon-container {
    background-color: #8bac0f !important;
    border: 4px solid #0f380f !important;
    transform: translateY(-8px);
}
[data-theme='brick'] .trophy-slot.unlocked svg {
    color: #0f380f !important;
    filter: none !important;
}

/* Cube: Rainbow Shadow */
[data-theme='cube'] .trophy-slot.unlocked .trophy-icon-container {
    background-color: #ffffff !important;
    border-color: #ff4500 !important;
    box-shadow: 8px 8px 0px #ff4500, -8px -8px 0px #4b0082 !important;
}

/* OS: 3D Raised Bevel */
[data-theme='os'] .trophy-slot.unlocked .trophy-icon-container {
    background-color: #c0c0c0 !important;
    border: 2px solid !important;
    border-color: #ffffff #808080 #808080 #ffffff !important;
    box-shadow: 4px 4px 10px rgba(0,0,0,0.3) !important;
}

/* Legacy: Inverted High-Contrast */
[data-theme='legacy'] .trophy-slot.unlocked .trophy-icon-container {
    background-color: #ffffff !important;
    border: 2px solid #000000 !important;
}
[data-theme='legacy'] .trophy-slot.unlocked svg {
    color: #000000 !important;
}

.trophy-slot.unlocked .trophy-icon-container::after {
    content: ''; position: absolute; inset: -15px;
    background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
    opacity: 0.15; animation: pulse 3s infinite;
}

/* --- Alignment Chart / Skill Tree --- */
.skill-node {
    position: absolute; width: 3rem; height: 3rem;
    background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.5s ease; filter: grayscale(1) brightness(0.5);
}
.skill-node.active { filter: grayscale(0) brightness(1.2); transform: scale(1.1); box-shadow: 0 0 15px currentColor; }
